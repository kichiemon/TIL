# Google Cloud Kubernetes Day

コンテナを使った最新の開発アプローチを学ぶ

## 失敗しないアプリケーションモダナイゼーション

3月の終わりに前回会った

### モダナイゼーションとは？

モダナイゼーション
- クラウドの利用
- クライドネイティブ
- マイクロサービス
- Twelve-Factor App

Twelve-Factor App

マイクロサービスとは
- 小さなサービスを組み合わせて
- 各サービスはそれぞれのプロセス
- 軽量なメカニズムを使って通信
- HTTP Resource APIをつかうことが多い


### パネルディスカッション

むさびさん。 富士通
西口さん。フリークアウト
- Poets
- FreakOut Native

##### 質問→回答

Q. アーキテクチャ、DevOpsの導入

A: むさびさん
OMS(order management system)。
10年越えのアプリをリプレースした

スケーラビリティの確保：導入後ダウンタイムなし
保守・運用コストの増大：ランニングコスト3/5。機能搭載費用1/2
機能改善スピードの向上：

モノリシック→マイクロサービス
・歴史的背景を知って入り人も少ない
・触ったところの影響が、関係のないところに伝播する

昨年の1月に検討開始
→ 最初のうちは技術選定とか学習とか調査していた
→ 4月くらいで、開発開始
→ 3ヶ月くらいでリリースするまで進めた

?何人くらいでやったんだろう？

A: 西口さん
Red for Publishers アーキテクチャ
- GKE
- ぜんぶGKE
    - Deployment 10子くらい
    - バッチはCloud
- ログはfluentd→BigQueryにStreaming Insert
- CircleCI
- Cloud Buildによる継続的インテグレーション
- 構成変更はDeveloper・SREとわず相互レビュー

コンテナ化とServerlessでの比較、選定理由
- 広告のサービスなので高速性が大事
- 最近はServerlessがファーストチョイスでもいいが、
    - 10個くらいのアプリが協調して動くので、複雑化していく
    - 自分たちで調整していきやすいGKEを採用した

Q. チーム、体制について

どういうチーム編成にしたか、どうかわったか

A: むさびさん
**スモールスタート** する


A: 西口さん
Developer11名
SRE2名


Q. これからアプリケーションをモダナイズしようとしている起業に向けて

A: むさびさん
- まずクラウドネイティブの考え方になること
- コンテナベース

A: 西口さん
- 事例のキャッチアップ
- GKEいいよ




## 失敗しないアプリケーションモダナイゼーション DevOps

ソフトウェアが世界を飲み込む
Software is eating the world

DevOpsに取り組んでいるチームは、目標達成・超える可能性が1.53倍たかくなる

開発と運用の分断によってなにがおきるか
- 運用しようとしても、自分がちtで作業が完了できない

Kubernetes
- 依存関係を排除しつつ、関心元を分離する
- Kubernetesだけで実現できるのがメリット。シンプルかつ簡単

##### DevOpsを実践するための課題
インセンティブが一致しない
- 開発:早く作る・運用:安定して動かす
- やりたいこと、目標が異なる
問題と解決策
- 合理的でない安全性と定義
    - 必要な「安定」を定義して計測
    - 経営層・決定権のある人のサポート

安定性の定義
- システムを運用する人にとっての安定性と、実際のユーザーにとっての安定性には、違いがある
    - 99.9％と99.8%の差分をきちんと明確に説明できるかどうか
        - Courseraで講座やってる
安定性の計測
- pingとかよりも、レスポンスタイムなどの実際の物を使ったほうがいい。運用も簡単


Opsに求められるもの
- アオジのところを最適化していく
    - 障害の感覚
    - 障害の影響範囲
    - 障害を解決する時間
    - 障害を直す時間


改善の方向性
MTBF : 障害報告書
TTD  : 障害を検知するまでの時間。 メトリクスや監視の改善
TTM  : 直していくまでの時間。人的なばらつきがないように、トレーニングしたり。直すプロセスを自動化したりドキュメント化する
Impact : エンジニアリングによって、インパクトの出る範囲を小さくしよう。また、Change Management：変更を行う時に障害が出やすいので、変更範囲・影響範囲を小さくしよう

まとめ
- SRE本に取り上げられている
- SRE輪読会もやってる




















